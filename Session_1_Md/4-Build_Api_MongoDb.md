# Configure MongoDB

If using Windows, MongoDB is installed at C:\Program Files\MongoDB by default.

 Add C:\Program Files\MongoDB\Server\<version_number>\bin to the Path environment variable. This change enables MongoDB access from anywhere on your development machine.


Use the mongo Shell in the following steps to create a database, make collections, and store documents. For more information on mongo Shell commands, see Working with the mongo Shell.


1. Choose a directory on your development machine for storing the data. For example, C:\ReservationData on Windows. Create the directory if it doesn't exist. The mongo Shell doesn't create new directories.

2. Open a command shell. Run the following command to connect to MongoDB on default port 27017. Remember to replace <data_directory_path> with the directory you chose in the previous step.

       mongod --dbpath <data_directory_path>
3. Open another command shell instance. Connect to the default test database by running the following command:

        mongo 
    
4. Run the following in a command shell:

       use ReservationtoreDb
       
    If it doesn't already exist, a database named ReservationtoreDb is created. If the database does exist, its connection is opened for transactions.


5. Create a Reservation collection using following command:

        db.createCollection('Reservation')

The following result is displayed:

        { "ok" : 1 }
6. Define a schema for the Reservation collection and insert two documents using the following command:

console

Copy
```js
db.Reservation.insertMany([{'RoomId':'rmconf1234','Price':1540.93,'Category':'Computers','ReservationName':'Ralph Johnson'}, {'RoomId':'rmking1234','Price':143.15,'Category':'Computers','ReservationName':'Robert C. Martin'}])
```
7. The following result is displayed:

    ```js
    {
         "acknowledged" : true,
        "insertedIds" : [
          ObjectId("5bfd996f7b8e48dc15ff215d"),
          ObjectId("5bfd996f7b8e48dc15ff215e")
        ]
    }
    ```

> Note
>The ID's shown in this article will not match the IDs when you run this sample.

7. View the documents in the database using the following command:

        db.Reservation.find({}).pretty()
        
The following result is displayed:

    ```js
    {
        "Name": "John Jones",
        "Price": 1254.93,
        "RoomId": "125Conf",
        "FromDate": "1/5/2020",
        "ToDate": "1/8/2020",
        "Id": "5e14aed709e229d3184ae67e"
    },
    {
        "Name": "Lisa Love",
        "Price": 2054.93,
        "RoomId": "a123Conf",
        "FromDate": "1/12/2020",
        "ToDate": "1/20/2020",
        "Id": "5e14fa52188a05c014258026"
    },
    ```

The schema adds an autogenerated _id property of type ObjectId for each document.

The database is ready. You can start creating the ASP.NET Core web API.

# Create the ASP.NET Core web API project

* Visual Studio
* Visual Studio Code
* Visual Studio for Mac

1. Go to File > New > Project.

2. Select the ASP.NET Core Web Application project type, and select Next.

3. Name the project ReservationApi, and select Create.

4. Select the .NET Core target framework and ASP.NET Core 2.2. Select the API project template, and select Create.

5. Visit the [NuGet Gallery: MongoDB.Driver](https://www.nuget.org/packages/MongoDB.Driver/) to determine the latest stable version of the .NET driver for MongoDB. In the Package Manager Console window, navigate to the project root. Run the following command to install the .NET driver for MongoDB:

PowerShell  |   Copy
------------|------------
Install-Package MongoDB.Driver -Version {VERSION} |

## Add a configuration model

1. Add the following database configuration values to appsettings.json:

JSON  | Copy
------|----

```js
        {
            "ReservationtoreDatabaseSettings": {
            "ReservationCollectionName": "Reservation",
            "ConnectionString": "mongodb://localhost:27017",
            "DatabaseName": "ReservationtoreDb"
        },
            "Logging": {
            "IncludeScopes": false,
            "Debug": {
            "LogLevel": {
            "Default": "Warning"
            }
        },
    "Console": {
      "LogLevel": {
        "Default": "Warning"
        }
       }
      }
    }
```

C#   | Copy
------|----

```cs
using ReservationApi.Models;
```

## Configure JSON serialization options

There are two details to change about the JSON responses returned in the Test the web API section:

* The property names' default camel casing should be changed to match the Pascal casing of the CLR object's property names.
* The ReservationName property should be returned as Name.

To satisfy the preceding requirements, make the following changes:

1. JSON.NET has been removed from ASP.NET shared framework. Add a package reference to Microsoft.AspNetCore.Mvc.NewtonsoftJson.

2. In Startup.ConfigureServices, chain the following highlighted code on to the AddMvc method call:

C#   | Copy
------|----

```cs
services.AddMvc(options =>
{
    options.ReturnHttpNotAcceptable = true;
    //XML Formatter
    options.OutputFormatters.Add(new XmlSerializerOutputFormatter());
})
    .SetCompatibilityVersion(CompatibilityVersion.Version_2_2)
    .AddJsonOptions(options => options.UseMemberCasing());
```

## Add Startup 
```cs
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Formatters;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using ReservationApi.Data.EFCore.DependencyInjection;
using ReservationApi.Data.MongoDb.DependencyInjection;
using ReservationApi.DependencyInjection;
using ReservationApi.Services;

namespace ReservationApi
{
    public class Startup
    {
        public Startup(IConfiguration configuration)
        {
            Configuration = configuration;
        }

        public IConfiguration Configuration { get; }

        // This method gets called by the runtime. Use this method to add services to the container.
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddMvc(options =>
            {
                options.ReturnHttpNotAcceptable = true;
                //XML Formatter
                options.OutputFormatters.Add(new XmlSerializerOutputFormatter());
            })
                .SetCompatibilityVersion(CompatibilityVersion.Version_2_2)
                .AddJsonOptions(options => options.UseMemberCasing());

            services.AddScoped<IReservationService, ReservationService>();

            //services.AddSqlDatabaseSupport(Configuration);
            services.AddMongoDatabaseSupport(Configuration);

            services.AddCorsConfiguration(Configuration);

        }

        // This method gets called by the runtime. Use this method to configure the HTTP request pipeline.
        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            if (env.IsDevelopment())
            {
                app.UseDeveloperExceptionPage();
            }
            else
            {
                // The default HSTS value is 30 days. You may want to change this for production scenarios, see https://aka.ms/aspnetcore-hsts.
                app.UseHsts();
            }

            // Session 3
            app.UseAuthentication();
            app.UseHttpsRedirection();

            app.UseMvc();
        }
    }
}
```
## Add Controller

using Microsoft.AspNetCore.Mvc;
using ReservationApi.Data.Models;
using ReservationApi.Services;
using System.Collections.Generic;
using System.Threading.Tasks;

namespace ReservationApi.Controllers
{
    [Route("api/[controller]")]
    [ApiController]
    public class ReservationController : ControllerBase
    {
        private readonly IReservationService _reservationService;

        public ReservationController(IReservationService reservationSvc)
        {
            _reservationService = reservationSvc;
        }

        [HttpGet]
        public async Task<ActionResult<List<Reservation>>> GetAsync()
        {
            var reservations = await _reservationService.GetAsync();

            return reservations;
        }

        [HttpGet("{id}", Name = "GetReservation")]
        public async Task<ActionResult<Reservation>> GetAsync(string id)
        {
            var reservation = await _reservationService.GetAsync(id);

            if (reservation == null)
            {
                return NotFound();
            }

            return Ok(reservation);
        }

        [HttpPost]
        public async Task<ActionResult<Reservation>> CreateAsync(Reservation reservation)
        {
            if (reservation == null)
                return BadRequest("No Reservation supplied");

            //if id is passed in with request, empty it so it can be generated by data layer
            if (!string.IsNullOrEmpty(reservation.Id))
                reservation.Id = string.Empty;

            var newReservation = await _reservationService.CreateAsync(reservation);

            return CreatedAtRoute("GetReservation", new { id = reservation.Id }, newReservation);
        }

        [HttpPut("{id}")]
        public async Task<IActionResult> UpdateAsync(string id, Reservation reservationIn)
        {
            var reservation = await _reservationService.GetAsync(id);

            if (reservation == null)
            {
                //status code 404
                return NotFound();
            }

            await _reservationService.UpdateAsync(id, reservationIn);

            return NoContent();
        }

        [HttpDelete("{id}")]
        public async Task<IActionResult> DeleteAsync(string id)
        {
            var reservation = await _reservationService.GetAsync(id);

            if (reservation == null)
            {
                return NotFound();
            }

            await _reservationService.RemoveAsync(reservation.Id);

            return NoContent();
        }
    }
}
With the preceding change, property names in the web API's serialized JSON response match their corresponding property names in the CLR object type. For example, the Reservation class's Author property serializes as Author.

1. Repeat the steps defined in the Test the web API section. Notice the difference in JSON property names.

## Create Repositories for Data Access

In this section, we will create a repository for encapsulating the MongoDb client functionality as well as an implementation for EF Core.  The `ReservationService` implementation will utilize these repositories for data access to mongodb data and sql data.

The repository will also implement an interface called  `IRepository<T>` that will be used directly by the service and can be used for mocking out the mongodb client or EF Core dependency during unit testing.

### Create Data project

This project will house the repository interface and the `Reservation` model class.  It is meant to be shared between other repository implementations.

* Create new .NET Core Class Library ReservationApi.Data project and add the following folders.

  * **Interfaces**

  * **Models**

* Add a new class called `BaseEntity` to the Models folder and add the following implementation.

    ```cs
    using MongoDB.Bson.Serialization.Attributes;
    using MongoDB.Bson.Serialization.IdGenerators;

    namespace ReservationApi.Data.Models
    {
        public abstract class BaseEntity
        {
            [BsonId]
            [BsonRepresentation(MongoDB.Bson.BsonType.ObjectId)]
            public string Id { get; set; }
        }
    }
    ```

    >**NOTE**: This will be the base class that can be shared across other entities/models in the domain

* Add a new interface called `IRepository` to the Interfaces folder and add the following implementation

    ```cs
    using ReservationApi.Data.Models;
    using System.Collections.Generic;
    using System.Threading.Tasks;

    namespace ReservationApi.Data.Intefaces
    {
        public interface IRepository<T> where T : BaseEntity
        {
            Task DeleteAsync(T entity);
            Task DeleteAsync(string id);
            Task<T> GetAsync(string id);
            Task<List<T>> GetAsync();
            Task<T> InsertAsync(T entity);
            Task UpdateAsync(T entity);
        }
    }
    ```

* Add a new class called `Reservation` to the Models folder and add the following implementation

    ```cs
    using MongoDB.Bson.Serialization.Attributes;
    using Newtonsoft.Json;
    using System.ComponentModel.DataAnnotations;

    namespace ReservationApi.Data.Models
    {
        public class Reservation : BaseEntity
        {
            [JsonProperty("Name")]
            [BsonElement("Name")]
            [MaxLength(150)]
            public string Name { get; set; }

            public decimal Price { get; set; }
            public string RoomId { get; set; }
            public string FromDate { get; set; }
            public string ToDate { get; set; }
        }
    }
    ```

    >**NOTE**: This entity inherits from the `BaseEntity` which provides the id property

### Create MongoDb Repository project

This project will house the MongoDb Client SDK and implement the `IRepository<>` interface within the data project

* Create a new .NET Core Class Library project called `ReservationApi.Data.MongoDb` within the solution.

* Add the following nuget references to project file

    ```xml
    <ItemGroup>
        <PackageReference Include="Microsoft.Extensions.Configuration" Version="2.2.0" />
        <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="2.2.0" />
        <PackageReference Include="MongoDB.Driver" Version="2.10.0" />
    
    </ItemGroup>
    ```

* Create the following folder within the project

  * **Repos**

  * **DependencyInjection**

* Create a new class called `MongoRepository` within the Repos folder and add the following implementation.

  ```cs
    using MongoDB.Driver;
    using ReservationApi.Data.Intefaces;
    using ReservationApi.Data.Models;
    using System.Collections.Generic;
    using System.Threading.Tasks;

    namespace ReservationApi.Data.MongoDb.Repos
    {
        public class MongoRepository<T> : IRepository<T> where T : BaseEntity
        {
            private readonly IMongoCollection<T> _collection;

            public MongoRepository(IMongoCollection<T> collection)
            {
                _collection = collection;
            }
            public async Task DeleteAsync(T entity)
            {
                await _collection.DeleteOneAsync(x => x.Id == entity.Id);
            }

            public async Task DeleteAsync(string id)
            {
                await _collection.DeleteOneAsync(x => x.Id == id);
            }

            public async Task<T> GetAsync(string id)
            {
                return await _collection.Find<T>(book => book.Id == id).FirstOrDefaultAsync();
            }

            public async Task<List<T>> GetAsync()
            {
                return await _collection.Find(reservation => true).ToListAsync();
            }

            public async Task<T> InsertAsync(T entity)
            {
                await _collection.InsertOneAsync(entity);
                return entity;
            }

            public async Task UpdateAsync(T entity)
            {
                await _collection.ReplaceOneAsync(book => book.Id == entity.Id, entity);
            }
        }
    }
    ```

    >**NOTE**: This is the implementation of the `IRepository<>` interface that will be used within the Service project.

* Create a new class called `ServiceCollectionExtensions` within the DependencyInjection folder and add the following implementation.

    ```cs
    using Microsoft.Extensions.Configuration;
    using Microsoft.Extensions.DependencyInjection;
    using Microsoft.Extensions.DependencyInjection.Extensions;
    using MongoDB.Driver;
    using ReservationApi.Data.Intefaces;
    using ReservationApi.Data.Models;
    using ReservationApi.Data.MongoDb.Repos;

    namespace ReservationApi.Data.MongoDb.DependencyInjection
    {
        public static class ServiceCollectionExtensions
        {
            public static void AddMongoDatabaseSupport(this IServiceCollection services, IConfiguration configuration)
            {
                services.AddScoped<IMongoCollection<Reservation>>(sp =>
                {
                    var config = configuration.GetSection("ReservationDataBaseSettings");

                    var client = new MongoClient(config["ConnectionString"]);
                    var database = client.GetDatabase(config["DatabaseName"]);

                    return database.GetCollection<Reservation>(config["ReservationCollectionName"]);
                });

                services.TryAddScoped<IRepository<Reservation>, MongoRepository<Reservation>>();
            }
        }
    }
    ```

    >**NOTE**: This is an extension method to the ServiceCollection DI container for ASP.NET Core.  The ReservationApi webapi project will use this to easily register the MongoDb Repository within DI.

* Make sure to add a reference to the `ReservationApi.Data` project in order to have access to the interface.

### Creating the EF Core repository project

This project will implement access to SQL Server using Entity Framework Core.  This project will utilize the shared Data project for access to the `IRepository<>` interface as well as the `Reservation` model class.

* Create new .NET Core Class Library project called `ReservationApi.Data.EFCore` to the solution and create the following folders

  * **Repos**

  * **DependencyInjection**

  * **Contexts**

* Add the following nuget references to project file

    ```xml
    <ItemGroup>
        <PackageReference Include="Microsoft.EntityFrameworkCore" Version="2.2.6" />
        <PackageReference Include="Microsoft.EntityFrameworkCore.SqlServer" Version="2.2.6" />
        <PackageReference Include="Microsoft.Extensions.Configuration" Version="2.2.0" />
        <PackageReference Include="Microsoft.Extensions.DependencyInjection" Version="2.2.0" />
    </ItemGroup>

    ```

* Add a new class called `EFRepository` to the Repos folder and add the following implementation

    ```cs
    using Microsoft.EntityFrameworkCore;
    using ReservationApi.Data.Intefaces;
    using ReservationApi.Data.Models;
    using System;
    using System.Collections.Generic;
    using System.Threading.Tasks;

    namespace ReservationApi.Data.EFCore.Repos
    {
        public class EFRepository<T> : IRepository<T> where T : BaseEntity
        {
            protected readonly DbContext _context;
            protected DbSet<T> _entities;

            public EFRepository(DbContext context)
            {
                _context = context;
                _entities = context.Set<T>();
            }

            public async Task DeleteAsync(T entity)
            {
                _context.Remove<T>(entity);
                await _context.SaveChangesAsync();
            }

            public async Task DeleteAsync(string id)
            {
                var entityToDelete = await _entities.FindAsync(id);
                _context.Remove<T>(entityToDelete);
                await _context.SaveChangesAsync();
            }

            public async Task<T> GetAsync(string id)
            {
                return await _entities.FindAsync(id);
            }

            public async Task<List<T>> GetAsync()
            {
                return await _entities.ToListAsync();
            }

            public async Task<T> InsertAsync(T entity)
            {
                if (entity == null)
                    throw new ArgumentNullException(nameof(entity), "entity cannot be null");

                entity.Id = Guid.NewGuid().ToString();

                var newEntity = await _entities.AddAsync(entity);
                await _context.SaveChangesAsync();
                return newEntity.Entity;
            }

            public async Task UpdateAsync(T entity)
            {
                var entityToEdit = _entities.Find(entity.Id);

                if (entityToEdit == null)
                    throw new ArgumentException($"Couldn't find matching {nameof(T)} with Id={entity.Id}");

                _context.Entry(entityToEdit).CurrentValues.SetValues(entity);
                await _context.SaveChangesAsync();
            }
        }
    }
    ```

    >**NOTE**: This is the EF Core implementation of the IRepository<> interface

* Add a new class called `ReservationContext` within the Contexts folder and add the following implementation

    ```cs
    using Microsoft.EntityFrameworkCore;
    using ReservationApi.Data.Models;

    namespace ReservationApi.Data.EFCore.Contexts
    {
        public class ReservationContext : DbContext
        {
            public ReservationContext(DbContextOptions<ReservationContext> options) : base(options) { }

            public DbSet<Reservation> Products { get; set; }

            protected override void OnModelCreating(ModelBuilder modelBuilder)
            {
            }
        }
    }
    ```

* Add a new class called `ServiceCollectionExtensions` to the DependencyInjection folder and add the following implementation

    ```cs
    using Microsoft.EntityFrameworkCore;
    using Microsoft.Extensions.Configuration;
    using Microsoft.Extensions.DependencyInjection;
    using Microsoft.Extensions.DependencyInjection.Extensions;
    using ReservationApi.Data.EFCore.Contexts;
    using ReservationApi.Data.EFCore.Repos;
    using ReservationApi.Data.Intefaces;
    using ReservationApi.Data.Models;

    namespace ReservationApi.Data.EFCore.DependencyInjection
    {
        public static class ServiceCollectionExtensions
        {
            public static void AddSqlDatabaseSupport(this IServiceCollection services, IConfiguration configuration)
            {
                services.AddDbContext<ReservationContext>(options =>
                    options.UseSqlServer(configuration.GetConnectionString("DefaultConnection")));

                services.TryAddScoped<DbContext, ReservationContext>();
                services.TryAddScoped<IRepository<Reservation>, EFRepository<Reservation>>();
            }
        }
    }
    ```

    >**NOTE**: This is the extension method for registering SQL Server provider for EF Core within the `ReservationApi` webapi project.

* Use the following commands to create the SQL Server database using LocalDb

  * `Add-Migration 'initial' -project ReservationApi.Data.EFCore`
  
    This command will create a new folder within the `ReservationApi.Data.EFCore` project called **migrations** and will create some auto generated migration classes for scaffolding the database

  * `Update-Database`

    This command wll run the 'initial' migration that was just created and create the SQL Server database using the configured connection string within the `ReservationApi` webapi project.

* Add the SQL Server connection string to the WebApi project's `appsetting.development.json` file using the following config

    ```js
    "ConnectionStrings": {
        "DefaultConnection": "Server=(localdb)\\mssqllocaldb;Database=ReservationDb;Trusted_Connection=True;MultipleActiveResultSets=true"
    }
    ``` 

    >**NOTE**: This connection string points to the LocalDb instance on the local computer and uses interactive user

## Configure WebApi to use Repositories

In this section, we'll add project references to the `ReservationApi` webapi project and configure the project to use either the MongoDb or EF Core repositories.  We'll then update the `ReservationService` class to inject the new `IRepository<>` implementation of choice.

* Add the following project reference to the `ReservationApi` project file

    ```xml
    <ItemGroup>
        <ProjectReference Include="..\ReservationApi.Data.EFCore\ReservationApi.Data.EFCore.csproj" />
        <ProjectReference Include="..\ReservationApi.Data.MongoDb\ReservationApi.Data.MongoDb.csproj" />
        <ProjectReference Include="..\ReservationApi.Data\ReservationApi.Data.csproj" />
    </ItemGroup>
    ```

* Create the `ReservationService` implementation to the following

    ```cs
    using ReservationApi.Data.Intefaces;
    using ReservationApi.Data.Models;
    using System.Collections.Generic;
    using System.Threading.Tasks;

    namespace ReservationApi.Services
    {
        public class ReservationService : IReservationService
        {
            private readonly IRepository<Reservation> _repo;

            public ReservationService(IRepository<Reservation> repo)
            {
                _repo = repo;
            }

            public async Task<List<Reservation>> GetAsync() =>
            await _repo.GetAsync();

            public async Task<Reservation> GetAsync(string id) =>
                await _repo.GetAsync(id);

            public async Task<Reservation> CreateAsync(Reservation reservation)
            {
                await _repo.InsertAsync(reservation);
                return reservation;
            }

            public async Task UpdateAsync(string id, Reservation reservationIn) =>
                await _repo.UpdateAsync(reservationIn);

            public async Task RemoveAsync(Reservation reservationIn) =>
                await _repo.DeleteAsync(reservationIn);

            public async Task RemoveAsync(string id) =>
                await _repo.DeleteAsync(id);
        }
    }
    ```

    >**NOTE**: This implementation receives an injected `IRepository<Reservation>` instance, could be MongoDb could be EFCore, and uses this to access the appropriate data store.

* Register either the MongoDb repo or EFCore repo with the `ReservationApi` project by adding the following code to the `ConfigureServices()` method within the `Startup` class.

    ```cs
        //services.AddSqlDatabaseSupport(Configuration);
        services.AddMongoDatabaseSupport(Configuration);
    ```

    >**NOTE**: This snippet of code registers the MongoDb repo, but has a commented out line for the EFCore repo.

## Add authentication support to a web API

ASP.NET Core Identity adds user interface (UI) login functionality to ASP.NET Core web apps. To secure web APIs and SPAs, use one of the following:

* Azure Active Directory
* Azure Active Directory B2C (Azure AD B2C)]
* IdentityServer4

IdentityServer4 is an OpenID Connect and OAuth 2.0 framework for ASP.NET Core. IdentityServer4 enables the following security features:

* Authentication as a Service (AaaS)
* Single sign-on/off (SSO) over multiple application types
* Access control for APIs
* Federation Gateway

For more information, see Welcome to [IdentityServer4](http://docs.identityserver.io/en/latest/index.html).

## Create Unit Tests

In this section, we will create a new unit test project and create a few unit tests based on behavioral mocks using MOQ.

* Add a new Unit Test project called `ReservationApi.Tests` and base it off of the xUnit .NET Core template.

* Rename the default test class to `ReservationServiceTests.cs`

* Add the following project references to the project file

  ```xml
  <ItemGroup>
    <ProjectReference Include="..\ReservationApi.Data\ReservationApi.Data.csproj" />
    <ProjectReference Include="..\ReservationApi\ReservationApi.csproj" />
  </ItemGroup>
  ```

* Add the following nuget package reference to the project file

  ```xml
    <PackageReference Include="Moq" Version="4.13.1" />
  ```

  or

  run the following command

  `dotnet add package Moq --version 4.13.1`

* Create first tests by adding the following implementation

    ```cs
    using Moq;
    using ReservationApi.Data.Intefaces;
    using ReservationApi.Data.Models;
    using ReservationApi.Services;
    using System;
    using Xunit;

    namespace ReservationApi.Tests
    {
        public class ReservationServiceTests
        {
            private Mock<IRepository<Reservation>> _mockRepo;

            public ReservationServiceTests()
            {
                _mockRepo = new Mock<IRepository<Reservation>>();
            }

            [Fact]
            public void ReservationService_Get_Reservation_Verify()
            {
                //arrange
                _mockRepo.Setup(x => x.GetAsync(It.IsAny<string>())).Verifiable();

                var reservationSvc = new ReservationService(_mockRepo.Object);

                //act
                var result = reservationSvc.GetAsync("1");

                //assert
                _mockRepo.Verify();
            }

            [Fact]
            public void ReservationService_Create_Reservation_Verify()
            {
                //arrange
                var reservation = new Reservation
                {
                    Id = Guid.NewGuid().ToString(),
                    Name = "Special Meeting",
                    RoomId = "101",
                    FromDate = DateTime.Today.ToString(),
                    ToDate = DateTime.Today.AddDays(1).ToString(),
                    Price = 1
                };

                _mockRepo.Setup(x => x.InsertAsync(It.IsAny<Reservation>())).Verifiable();

                var reservationSvc = new ReservationService(_mockRepo.Object);

                //act
                var result = reservationSvc.CreateAsync(reservation);

                //assert
                _mockRepo.Verify();
            }

            [Fact]
            public void ReservationService_Delete_Reservation_Verify()
            {
                //arrange
                var reservation = new Reservation
                {
                    Id = Guid.NewGuid().ToString(),
                    Name = "Special Meeting",
                    RoomId = "101",
                    FromDate = DateTime.Today.ToString(),
                    ToDate = DateTime.Today.AddDays(1).ToString(),
                    Price = 1
                };

                _mockRepo.Setup(x => x.DeleteAsync(It.IsAny<Reservation>())).Verifiable();

                var reservationSvc = new ReservationService(_mockRepo.Object);

                //act
                var result = reservationSvc.RemoveAsync(reservation);

                //assert
                _mockRepo.Verify();
            }

            [Fact]
            public void ReservationService_Update_Reservation_Verify()
            {
                //arrange
                var reservation = new Reservation
                {
                    Id = Guid.NewGuid().ToString(),
                    Name = "Special Meeting",
                    RoomId = "101",
                    FromDate = DateTime.Today.ToString(),
                    ToDate = DateTime.Today.AddDays(1).ToString(),
                    Price = 1
                };

                _mockRepo.Setup(x => x.UpdateAsync(It.IsAny<Reservation>())).Verifiable();

                var reservationSvc = new ReservationService(_mockRepo.Object);

                //act
                var result = reservationSvc.UpdateAsync(reservation.Id, reservation);

                //assert
                _mockRepo.Verify();
            }

        }
    }
    ```

    >**NOTE**: Because this demo doesn't contain much business logic, these tests are behavioral tests and will check to see if the method under test actually calls a specific dependency, as opposed to manipulating some state that can be asserted.
    
* Run the tests using the Test Explorer and see if they pass.
